/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
import{events as e}from"../../common/analytics.js";import{dcLocalStorage as t}from"../../common/local-storage.js";import{util as o}from"./content-util.js";import{privateApi as a}from"./content-privateApi.js";import{OptionPageActions as n}from"../../common/constant.js";await t.init();const s="pdfOwnershipExploreOptionsTitle";var i,r,l,d,c=!1,_=!1;function p(e,t,a){delete e.trefoilClick,delete e.dataURL,delete e.click_context,e.authenticatedPDF&&1==e.authenticatedPDF&&delete e.authenticatedPDF,o.messageToMain(e,a),delete e.newUI,delete e.trefoilUI,delete e.analytics,delete e.is_viewer,delete e.reload_in_native,r&&(clearTimeout(r),r=null),t||"dismiss"===e.content_op||"resize_window"===e.content_op||u()}function E(){r&&(clearTimeout(r),r=null),SETTINGS.IS_ERP_READER?$(".acrobatMainDiv").stop().css("display","none"):$(".acrobatMainDiv").stop().css("opacity",1)}function f(e){return!!SETTINGS.TEST_MODE||!(!e||!e.show_frictionless||0!=e.version&&(1!=e.version||0!=e.NMHConnStatus)&&e.version!=SETTINGS.READER_VER)}function T(){delete i.current_status,delete i.file_path,delete i.domtitle,delete i.timing,delete i.panel_op,delete i.is_pdf,delete i.trefoilUI,delete i.newUI}function m(e,t){const a={main_op:"analytics",analytics:[[e,t]]};o.messageToMain(a)}function u(){T(),i.content_op="dismiss",i.main_op="relay_to_content",i.trefoilUI=!0,"search"===i.frictionless_workflow&&1==i.show_frictionless&&(i.suppress_frictionless=!0),delete i.newUI,p(i)}function I(t){(i.version>1||SETTINGS.IS_ERP_READER||SETTINGS.IS_READER)&&(0==t?(i.content_op="dismiss",i.main_op="relay_to_content",i.newUI=!0,i.persist=!1,o.analytics(i,e.PERSIST_PDF_MENU_CLOSED),p(i),delete i.content_op,delete i.main_op):1==t&&(i.panel_op="pdf_menu",i.main_op="relay_to_content",i.persist=!0,o.analytics(i,e.PERSIST_PDF_MENU_SHOWN),delete i.content_op,i.newUI=!0,p(i,!0),delete i.persist,delete i.panel_op,delete i.main_op))}function C(){r=null,$(".acrobatMainDiv").animate({opacity:0},1500,"swing",u)}function h(){(SETTINGS.TEST_MODE||SETTINGS.DEBUG_MODE)&&(r=1),r||c||(r=setTimeout((function(){setTimeout(C)}),i.is_pdf?3e3:1500))}async function S(){i.main_op="open_in_acrobat",i.trefoilUI=!0,void 0!==i.paramName&&delete i.paramName;p(await o.handlePDFURL(i,!0),!0)}async function v(e){i.main_op="open_in_acrobat",i.trefoilUI=!1,i.paramName=e,delete i.content_op;p(await o.handlePDFURL(i,!0),!0)}function w(t){i.pdf_action=t,i.main_op="get-frictionless-url",i.frame_visibility="visible",i.frictionless_workflow="trefoil",i.startup_time=Date.now(),"resize_window"==i.content_op&&(i.content_op=null),"createpdf"==t?o.analytics(i,e.FRICTIONLESS_TOOL_SELECTED,{TOOL:"CREATE_PDF"}):"compress-pdf"==t&&o.analytics(i,e.FRICTIONLESS_TOOL_SELECTED,{TOOL:"COMPRESS_PDF"}),p(i,!0)}function O(a,n){a&&function(e){l=e,t.setItem("ViewResultsPref",l?"true":"false"),$(".do_set_open_pref").toggleClass("open-pdf-in-acrobat")}(n),i.main_op="convertToPDFPopupMenu",a&&(i.outputPath=a),p(i,!0),a||(o.analytics(i,e.TREFOIL_HTML_CONVERT_NEW),t.getItem("ViewResultsPref")?l?o.analytics(i,e.TREFOIL_HTML_CONVERT_OPEN_CHANGED):o.analytics(i,e.TREFOIL_HTML_CONVERT_NO_OPEN):o.analytics(i,e.TREFOIL_HTML_CONVERT_OPEN_DEFAULT))}function R(a){i.main_op="appendToExistingPDFPopupMenu",a&&(i.outputPath=a),p(i,!0),a||(o.analytics(i,e.TREFOIL_HTML_CONVERT_APPEND),t.getItem("ViewResultsPref")?l?o.analytics(i,e.TREFOIL_HTML_CONVERT_OPEN_CHANGED):o.analytics(i,e.TREFOIL_HTML_CONVERT_NO_OPEN):o.analytics(i,e.TREFOIL_HTML_CONVERT_OPEN_DEFAULT))}function g(e){try{let t=new URL(i.frictionless_uri);e.origin===t.origin&&(i.main_op="external_msg",i.data=e.data,i.timeStamp=Date.now(),o.messageToMain(i))}catch(e){}}function L(){m(e.TREFOIL_SETTINGS_ICON_CLICKED),chrome.runtime.openOptionsPage((t=>{chrome.runtime.lastError&&m(e.TREFOIL_SETTINGS_FAILED_TO_OPEN)}))}function N(a,n){"true"===n&&t.setItem("viewer-enabled-source","ownership-consent"),t.getWithTTL("ownership-upgrade")&&"false"===n&&(o.analytics(a,e.USE_ACROBAT_VIEWER_DISABLED_DEFAULT_OWNERSHIP,{SOURCE:"trefoilMenu"}),o.analytics(a,e.USE_ACROBAT_VIEWER_DISABLED_DEFAULT_OWNERSHIP_EXPERIMENT,{SOURCE:"trefoilMenu",EXPERIMENT:t.getItem("experiment-ownership")}),t.removeItem("ownership-upgrade"),t.removeItem("defaultOwnerShipExperiment"))}function D(){if(!_){_=!0,window.addEventListener("message",g,!1),$(".do_acrobat").click((function(e){let t=$(e.currentTarget);E(),t.hasClass("do_acrobat_FS")?v("FillnSign"):t.hasClass("do_acrobat")&&S()})),$(".do_frictionless_create, .do_frictionless_compress, .do_frictionless_pdf_to_word, .do_frictionless_pdf_to_jpg, .do_frictionless_pdf_to_excel, .do_frictionless_pdf_to_ppt").click((function(t){let a=$(t.currentTarget);E(),o.isEdge()?(i.main_op="go_to_aonline",a.hasClass("do_frictionless_create")?(i.verb="convert_pdf",m(e.FRICTIONLESS_TOOL_SELECTED_CONVERT_PDF)):a.hasClass("do_frictionless_compress")?(i.verb="compress_pdf",m(e.FRICTIONLESS_TOOL_SELECTED_COMPRESS_PDF)):a.hasClass("do_frictionless_pdf_to_word")?(i.verb="pdf_to_word",m(e.FRICTIONLESS_TOOL_SELECTED_PDFTOWORD)):a.hasClass("do_frictionless_pdf_to_jpg")?(i.verb="pdf_to_jpg",m(e.FRICTIONLESS_TOOL_SELECTED_PDFTOJPG)):a.hasClass("do_frictionless_pdf_to_excel")?(i.verb="pdf_to_excel",m(e.FRICTIONLESS_TOOL_SELECTED_PDFTOEXCEL)):a.hasClass("do_frictionless_pdf_to_ppt")&&(i.verb="pdf_to_ppt",m(e.FRICTIONLESS_TOOL_SELECTED_PDFTOPPT)),p(i)):a.hasClass("do_frictionless_create")?w("createpdf"):a.hasClass("do_frictionless_compress")?w("compress-pdf"):a.hasClass("do_frictionless_pdf_to_word")?w("pdf-to-word"):a.hasClass("do_frictionless_pdf_to_jpg")?w("pdf-to-image"):a.hasClass("do_frictionless_pdf_to_excel")?w("pdf-to-excel"):a.hasClass("do_frictionless_pdf_to_ppt")&&w("pdf-to-ppt")})),$(".do_frictionless_edit , .do_frictionless_edit_rotate, .do_frictionless_edit_delete, .do_frictionless_edit_reorder, .do_frictionless_sign_fillandsign, .do_frictionless_sign_requestsignatures").click((function(t){let o=$(t.currentTarget);i.main_op="go_to_aonline",o.hasClass("do_frictionless_edit_rotate")?(i.verb="edit_rotate",m(e.FRICTIONLESS_TOOL_SELECTED_EDIT_ROTATE)):o.hasClass("do_frictionless_edit_delete")?(i.verb="edit_delete",m(e.FRICTIONLESS_TOOL_SELECTED_EDIT_DELETE)):o.hasClass("do_frictionless_edit_reorder")?(i.verb="edit_reorder",m(e.FRICTIONLESS_TOOL_SELECTED_EDIT_REORDER)):o.hasClass("do_frictionless_sign_fillandsign")?(i.verb="fillandsign",m(e.FRICTIONLESS_TOOL_SELECTED_FILL_SIGN)):o.hasClass("do_frictionless_sign_requestsignatures")&&(i.verb="request_signatures",m(e.FRICTIONLESS_TOOL_SELECTED_REQUEST_SIGNATURES)),p(i)})),$(".accordiontoggle").click((function(e){e.preventDefault();let t=$(this);t.next().next().hasClass("show")?(t.next().next().removeClass("show"),t.next().addClass("show"),t.next().css("display","block"),t.next().next().slideUp(0),t.next().delay(0).slideDown(0),t.addClass("stacked"),t.removeClass("collapsed")):(t.next().removeClass("show"),t.next().next().addClass("show"),t.addClass("collapsed"),t.removeClass("stacked"),t.next().slideUp(0),t.next().next().slideDown(0))})),$(".do_visit_acom, .do_html_to_pdf, .go_to_aonline").click((function(t){let a=$(t.currentTarget);E(),a.hasClass("do_visit_acom")&&(i.is_pdf?o.analytics(i,e.TREFOIL_PDF_VISIT_AIC):o.analytics(i,e.TREFOIL_HTML_VISIT_AIC),i.handleResult="acom",i.main_op="goto_acom",p(i)),a.hasClass("do_html_to_pdf")&&O(),a.hasClass("go_to_aonline")&&(i.main_op="go_to_aonline",i.verb="default",p(i),m(e.ACROBAT_ONLINE_CLICKED))})),$(".close-dialog").click((function(){$(".acrobatMainDiv").length>0&&$(".acrobatMainDiv").hasClass("widget-screen-main-div")&&o.analytics(i,e.FRICTIONLESS_WIDGET_CROSS_CLICKED),u()})),$(".settings-dialog").click(L),$(".action-available-click").click((function(t){let o=$(t.currentTarget);E(),console.log(o),i.main_op="go_to_aonline",i.verb="acrobat_label",m(e.TREFOIL_ACROBAT_LABEL_CLICKED),p(i)})),$(".acrobatMainDiv").hover(E,h),$(".sign-out").click((function(){o.analytics(i,e.SIGN_OUT_CLICKED),i.main_op="sign-out",p(i)})),$("#special").click((function(){o.analytics(i,e.FLICKR_OFFER_CLICKED),i.main_op="flickr",p(i)})),$(".do_html_add_to_pdf").click((function(){R()})),$(".do_set_open_pref").click((function(){l=!(l=$(".do_set_open_pref").hasClass("open-pdf-in-acrobat")),t.setItem("ViewResultsPref",l?"true":"false"),$(".do_set_open_pref").toggleClass("open-pdf-in-acrobat"),l?o.analytics(i,e.TREFOIL_HTML_OPENPDF_PREF_OFF):o.analytics(i,e.TREFOIL_HTML_OPENPDF_PREF_ON),i.main_op="send-analytics",p(i,!0)})),$(".do_set_pdf_viewer").click((async function(){d=$(".do_set_pdf_viewer").hasClass("open_in_pdf_viewer"),N(i,d=!d),t.setItem("pdfViewer",d.toString()),await a.setViewerState(d?"enabled":"disabled");try{t.removeItem("netAccAdT"),t.removeItem("netAcc"),t.removeItem("netAccCN")}catch(e){}$(".do_set_pdf_viewer").toggleClass("open_in_pdf_viewer"),d?o.isEdge()?o.analytics(i,e.USE_ACROBAT_IN_EDGE_ENABLED):o.isChrome()&&o.analytics(i,e.USE_ACROBAT_IN_CHROME_ENABLED):o.isEdge()?o.analytics(i,e.USE_ACROBAT_IN_EDGE_DISABLED):o.isChrome()&&o.analytics(i,e.USE_ACROBAT_IN_CHROME_DISABLED),setTimeout((()=>{i.is_viewer?p({panel_op:"viewer_menu",reload_in_native:!0,tabId:i.tabId},!0):i.is_pdf&&chrome.tabs.reload(),i.main_op="send-analytics",p(i,!0)}),20)})),$(".do-acro-prefs").click((function(){o.analytics(i,e.TREFOIL_HTML_PREFERENCES_CLICK),i.main_op="showConversionSettingsDialog",p(i)})),$(".convert").click((function(){$(".convert").hasClass("convert-button")&&(i.main_op="open_converted_file",p(i))})),$(".always-show").prop("checked","false"!==t.getItem("always-show-pdf-menu")),$(".api-option-container-inner").click((function(){let e=$(".always-show").prop("checked")?"false":"true";t.setItem("always-show-pdf-menu",e),$(".always-show").prop("checked","true"===e),"false"===e?I(!1):"true"===e&&I(!0)})),$(".always-show-pdftools").prop("checked","false"!==t.getItem("always-show-pdftools"));const r="true"===t.getItem("pdfViewer");$(".always-show-pdfvieweroption").prop("checked",r),r&&$(".do_set_pdf_viewer").addClass("open_in_pdf_viewer"),$(".api-option-container-inner-pdftools").click((function(){$(".desktop-app-reader .api-option-container input[type=checkbox] ~ .checkbox-toggle").removeClass("toggle-inactive-blue-circle");let o=$(".always-show-pdftools").prop("checked")?"false":"true";t.setItem("always-show-pdftools",o),$(".always-show-pdftools").prop("checked","true"===o),m("false"===o?e.FRICTIONLESS_AUTO_SUGGESTION_DISABLED:e.FRICTIONLESS_AUTO_SUGGESTION_ENABLED)})),$(".api-option-container-inner-pdfvieweroption").click((async function(){$(".desktop-app-reader .api-option-container input[type=checkbox] ~ .checkbox-toggle").removeClass("toggle-inactive-blue-circle");let r=$(".always-show-pdfvieweroption").prop("checked")?"false":"true";const l="true"===r?"enabled":"disabled";N(i,r),t.setItem("pdfViewer",r),await a.setViewerState(l);try{t.removeItem("netAccAdT"),t.removeItem("netAcc"),t.removeItem("netAccCN")}catch(e){}$(".always-show-pdfvieweroption").prop("checked","true"===r),"false"===r?o.isEdge()?o.analytics(i,e.USE_ACROBAT_IN_EDGE_DISABLED):o.isChrome()&&o.analytics(i,e.USE_ACROBAT_IN_CHROME_DISABLED):o.isEdge()?o.analytics(i,e.USE_ACROBAT_IN_EDGE_ENABLED):o.isChrome()&&o.analytics(i,e.USE_ACROBAT_IN_CHROME_ENABLED),setTimeout((()=>{i.is_viewer?p({panel_op:"viewer_menu",reload_in_native:!0,tabId:i.tabId},!0):i.is_pdf&&chrome.tabs.reload(),p({panel_op:"options_page",requestType:n.OPTIONS_UPDATE_TOGGLE,toggleId:s,toggleVal:r},!0),i.main_op="send-analytics",p(i,!0),o.isEdge()&&p({main_op:"pdfViewerChanged",value:r})}),20)}))}}function b(a){let n,s,r,l=!0,d=!0,_=!1,T="web2pdfStatusFailure",u="web2pdfStatusComplete";if(i&&a&&i.tabId&&a.tabId&&a.tabId!=i.tabId)return;if(!a.main_op||!["analytics","save-preferences","fetch-preferences","userSubscriptionData"].includes(a.main_op)){if(a.test_extension)return function(e){switch(o.consoleLog("TESTING"),o.consoleLogDir(JSON.stringify(e)),e.test_extension){case"to_html":O(e.outputPath,e.openPDF);break;case"doAcrobat":S();break;case"doAcrobat_FS":v("FillnSign");break;case"to_append":R(e.outputPath)}}(a);switch(a.version===SETTINGS.ERP_READER_VER&&(SETTINGS.IS_ERP_READER=!0),D(),delete(i={...a,tabId:i.tabId}).analytics,E(),c=!1,o.translateElements(".translate"),1===i.version&&$("#web2pdfOpenButtonText").val(o.getTranslation("web2pdfOpenButtonTextOlder")),1!==i.version&&0!==i.version||$("#web2pdfShowPersistentOpen").text(o.getTranslation("web2pdfAlwaysShow")),i.version===SETTINGS.READER_VER&&$("#web2pdfOpenButtonText").val(o.getTranslation("web2pdfOpenButtonText")),$(".ui-element").addClass("hidden"),$("#action_message").text(""),function(e,t){if(SETTINGS.DEBUG_MODE){let o,a=[t];for(o in e)e.hasOwnProperty(o)&&a.push("  "+o+": "+e[o]);console.log(a.join("\n"))}}(i,"Receive frame message:"),s=i.panel_op,delete i.panel_op,s){case"pdf_menu":c=!0,!0===SETTINGS.FILL_N_SIGN_ENABLED&&($("#web2pdfFillSignAcrobatButtonText").removeClass("hidden"),$(".acro-option.pdf").removeClass("hidden")),1==i.version&&0==i.NMHConnStatus||0==i.version?($(".go_to_aonline").removeClass("hidden"),i.show_frictionless||$(".do_visit_acom").addClass("hidden")):i.version===SETTINGS.READER_VER?($(".acro-option.pdf").removeClass("hidden"),$(".acro-option.pdf.horizontal-rule").addClass("hidden"),$(".acrobatMainDiv").removeClass("home-screen"),$(".acrobatMainDiv").addClass("pdf-screen"),$(".reader-option.pdf.horizontal-rule.pref-divider").removeClass("hidden")):($(".acro-option.pdf").removeClass("hidden"),$(".acro-option.pdf.horizontal-rule").removeClass("hidden")),function(){if(SETTINGS.VIEWER_ENABLED&&!i.incognito){let e=!(0==i.version||1==i.version||i.version===SETTINGS.READER_VER||i.version===SETTINGS.ERP_READER_VER);$(".acro-option-reader-pdf").removeClass("hidden"),$(".acro-option-reader-conditional").addClass("hidden"),!SETTINGS.VIEWER_ENABLED_FOR_ACROBAT&&e&&($(".acro-option-reader-pdf").addClass("hidden"),$(".acro-option-reader-conditional").removeClass("hidden"),$(".acro-option.pdf.horizontal-rule").addClass("hidden")),i.version<2||i.version===SETTINGS.READER_VER||($(".acro-option-reader-pdf").addClass("viewer-api-option-container"),$(".acro-option-reader-conditional").addClass("viewer-api-option-container")),i.version>1&&SETTINGS.VIEWER_SHOW_OPEN_IN_ACRO&&(10===parseInt(t.getItem("fteDenied"))||"false"===t.getItem("pdfViewer"))&&$(".acro-option-reader-conditional").removeClass("hidden")}}();break;case"viewer_menu":c=!0,SETTINGS.VIEWER_ENABLED&&!i.incognito&&($(".acro-option-reader-pdf").removeClass("hidden"),$(".acrobatMainDiv").css("width","-webkit-fill-available"),$(".status-dialog").css("width","-webkit-fill-available"),(i.version<2||i.version===SETTINGS.READER_VER)&&$(".api-option-container-inner-pdfvieweroption").css("padding-left","6px"));break;case"error":$(".error").removeClass("hidden").text("Unexpected Error:"+i.error.name+"\nReference: "+i.error.errnum+"\n"+i.error.details);break;case"flickr":$(".action-available").removeClass("hidden"),$("#action_message").text("Create slide shows and contact sheets."),$(".special_question").removeClass("hidden"),$("#special").removeClass("hidden");break;case"status":$(".progress-area").removeClass("hidden"),$(".convert").text(i.domtitle),$(".convert-status, .convert-title").addClass("hidden"),$(".convert").removeClass("convert-button hidden"),"waiting"===i.current_status?(o.analytics(i,e.TREFOIL_HTML_CONVERT_WAITING),n=o.getTranslation("web2pdfStatusWaiting"),l=!1):"downloading"===i.current_status?(o.analytics(i,e.TREFOIL_HTML_CONVERT_DOWNLOADING),n=o.getTranslation("web2pdfStatusDownloading"),l=!1):"in_progress"===i.current_status?(o.analytics(i,e.TREFOIL_HTML_CONVERT_IN_PROGRESS),n=o.getTranslation("web2pdfStatusInProgress"),l=!1):"filelocked"===i.current_status?n=o.getTranslation("web2pdfFileLockedError"):"cancelled"===i.current_status?(o.analytics(i,e.TREFOIL_HTML_CONVERT_CANCELLED),n=o.getTranslation("web2pdfStatusCancelled"),_=!0):"complete"===i.current_status?(o.analytics(i,e.TREFOIL_HTML_CONVERT_COMPLETE),i.file_path?($(".convert").text(o.getTranslation("web2pdfOpenInDCButtonText")),$(".convert").addClass("convert-button")):($(".convert").empty(),$(".convert").addClass("hidden"))):"failure"===i.current_status?(o.analytics(i,e.TREFOIL_HTML_CONVERT_FAILED),i.message&&(n=i.message,n=$("<div/>").text(n).html()),d=!1):"noacrobat"===i.current_status?(o.analytics(i,e.TREFOIL_HTML_CONVERT_NO_ACROBAT),n=o.getTranslation("web2pdfUnsupportedAcrobatVersion"),d=!1):"unknown"===i.current_status?(n=o.getTranslation("web2pdfStatusUnknownFailure"),d=!1):"pdf_downloading"===i.current_status?(n=o.getTranslation("web2pdfStatusDownloadingPDF"),l=!1):"pdf_failure"===i.current_status?(o.analytics(i,e.TREFOIL_PDF_DOWNLOAD_FAILED),T="web2pdfStatusUnknownFailure",d=!1):"pdf_downloaded"===i.current_status?(n=o.getTranslation("web2pdfPDFOpening"),l=!1):"pdf_opened"===i.current_status?(d=!0,u="web2pdfPDFOpened"):"pdf_open_failed"===i.current_status&&(d=!1,l=!0,T="web2pdfPDFOpenFailed"),n&&($(".convert-title").removeClass("hidden"),$(".convert-title").html(n)),l?(delete i.panel_op,r=i.is_pdf?".acro-option.pdf":".acro-option.html",$(r).removeClass("hidden"),$(".actions").removeClass("hidden"),$(".acro-option-conditional.html").addClass("hidden"),SETTINGS.VIEWER_ENABLED&&!i.incognito&&(!SETTINGS.VIEWER_ENABLED_FOR_ACROBAT&&i.version>1&&!SETTINGS.IS_ERP_READER&&!SETTINGS.IS_READER&&($(".acro-option-conditional.html").addClass("hidden"),$(".acro-option.pdf.horizontal-rule").addClass("hidden")),$(".status-dialog").css("width","-webkit-fill-available")),$(".convert").removeClass("convert-busy"),$(".convert-status").removeClass("hidden"),d?i.is_pdf?($(".progress-area").addClass("hidden"),$(".convert").removeClass("convert-busy"),$(".convert-status").addClass("hidden")):($(".convert-status-icon").addClass("icon-success"),$(".convert-status-title").text(o.getTranslation(u))):(c=!0,$(".convert-status-icon").removeClass("icon-success"),$(".convert-status-icon").addClass("icon-error"),$(".convert-status-title").text(o.getTranslation(T)),$(".convert").addClass("hidden")),_&&($(".convert-status").addClass("hidden"),$(".convert").addClass("hidden"))):(c=!0,$(".actions").addClass("hidden"),$(".convert").addClass("convert-busy"));break;case"html_menu":c=!0,f(i)?($(".reader-option.html").removeClass("hidden"),o.isEdge()&&$(".chrome-only").addClass("hidden"),SETTINGS.VIEWER_ENABLED||$(".acro-option-reader-pdf").addClass("hidden"),c=!0):($(".acro-option.html").removeClass("hidden"),$(".acro-option-conditional.html").addClass("hidden"),SETTINGS.VIEWER_ENABLED&&!i.incognito&&($(".acro-option-conditional.html").removeClass("hidden"),!SETTINGS.VIEWER_ENABLED_FOR_ACROBAT&&i.version>1&&!SETTINGS.IS_ERP_READER&&!SETTINGS.IS_READER&&$(".acro-option-conditional.html").addClass("hidden"),$(".status-dialog").css("width","-webkit-fill-available")));break;case"load-frictionless":if(c=!0,"resize_window"===i.content_op);else if(1==i.hide_spinner)delete i.hide_spinner,$(".frictionless-container").removeClass("hidden"),$(".frictionless-loader").addClass("hidden");else if(0==$(".frictionless-container").children().length){$(".acrobatMainDiv").removeClass("home-screen"),$(".acrobatMainDiv").addClass("widget-screen-main-div"),$(".actions").addClass("hidden"),"trefoil"===i.frictionless_workflow&&($(".frictionless-loader").removeClass("hidden"),$(".frictionless-loader").attr("data-loading-title",o.getTranslation("web2pdfLoaderTitle")||"Loading..."),$(".frictionless-container").addClass("hidden"));let a=function(o,a){let n=document.createElement("iframe");n.setAttribute("referrerpolicy","no-referrer"),n.classList.add("frictionless-iframe");let s=new URL(o);if(a.locale=chrome.i18n.getMessage("@@ui_locale"),a&&(i.locale?a.locale=i.locale:a.locale=chrome.i18n.getMessage("@@ui_locale"),Object.keys(a).forEach((e=>{s.searchParams.append(e,a[e])}))),"false"===t.getItem("logAnalytics")){let e=s.toString();e=e.concat("&app!analytics=disable");try{s=new URL(e)}catch(e){s=""}}if("test"===i.env||"stage"===i.env){let e=s.toString();e=e.concat("&app!versions=latest");try{s=new URL(e)}catch(e){s=""}}return n.onerror=function(t){m(e.FRICTIONLESS_WIDGET_LOADING_FAILED)},n.onload=function(e){p({iframe_onload_time:Date.now(),main_op:"timing_info",timing_op:"startup_to_iframe_load"},!0),"trefoil"===a.workflow&&n.contentWindow.postMessage({valid:!0},s.origin)},p({iframe_call_time:Date.now(),main_op:"timing_info"},!0),n.setAttribute("src",s),n}(i.frictionless_uri,{verb:i.pdf_action,workflow:i.frictionless_workflow,dropzone2:"true"});$(".frictionless-container").append(a),$(".frictionless-host").removeClass("hidden"),A()}break;case"show-frictionless-error":if(i.error_title&&i.error_description){let e=i.error_title,t=i.error_description;delete i.error_title,delete i.error_description,function(e,t){const o=$(".frictionless-error"),a=$(".error-title");$(".error-details").text(t),a.text(e),o.removeClass("hidden"),A()}(e,t)}break;case"clear-frictionless-error":$(".frictionless-error").addClass("hidden"),A();break;case"send-external-msg":try{let e=new URL(i.frictionless_uri),t=$(".frictionless-iframe");if(1==t.length){t[0].contentWindow.postMessage(i.data,e.origin),delete i.data}}catch(e){}c=!0}h()}}function A(){T(),i.content_op="resize_window",i.panel_op="load-frictionless",i.main_op="relay_to_content",delete i.newUI,delete i.trefoilUI,p(i),i.content_op=null,i.panel_op=null}o.isChrome()&&$((function(){D()})),o.addMainListener(b),$((function(){if(window.location.search){if(i=JSON.parse(decodeURIComponent(window.location.search.split("=")[1])),SETTINGS.TEST_MODE&&window.addEventListener("message",(function(e){b(e.data)}),!1),f(i)){let t;switch($(".do_visit_acom").addClass("hidden"),$("body").addClass("desktop-app-reader"),"html_menu"==i.panel_op&&($(".acrobatMainDiv").addClass("home-screen"),m(e.FRICTIONLESS_HOME_SCREEN_SHOWN)),i.locale){case"ja-JP":t={kitId:"vaq7mqd",scriptTimeout:3e3,async:!0};break;case"ko-KR":t={kitId:"leb2lwu",scriptTimeout:3e3,async:!0};break;case"zh_CN":t={kitId:"eyt7cbr",scriptTimeout:3e3,async:!0}}t&&(function(e){let o,a=e.documentElement,n=setTimeout((function(){a.className=a.className.replace(/\bwf-loading\b/g,"")+" wf-inactive"}),t.scriptTimeout),s=e.createElement("script"),i=!1,r=e.getElementsByTagName("script")[0];a.className+=" wf-loading",s.src="https://use.typekit.net/"+t.kitId+".js",s.async=!0,s.onload=s.onreadystatechange=function(){if(o=this.readyState,!(i||o&&"complete"!=o&&"loaded"!=o)){i=!0,clearTimeout(n);try{Typekit.load(t)}catch(e){}}},r.parentNode.insertBefore(s,r)}(document),function(){let e,t={"font-weight":"400"},o={"font-weight":"500"};switch(i.locale){case"ja-JP":e={"font-family":"adobe-clean-han-japanese"};break;case"ko-KR":e={"font-family":"adobe-clean-han-korean"};case"zh_CN":e={"font-famiy":"adobe-clean-han-simplified-c"}}e&&($(".desktop-app-reader").css(e),$(".desktop-app-reader .actions input[type=button]").css(e).css(t),$(".desktop-app-reader .action-available").css(e).css(o))}())}!function(e){var t;void 0!==(t=e)&&void 0!==t.paramName&&delete t.paramName,SETTINGS.FILL_N_SIGN_ENABLED=e.isFillnSignEnabled,SETTINGS.SHAREPOINT_ENABLED=e.isSharePointEnabled,b(e)}(i),"false"===t.getItem("ViewResultsPref")?l=!1:($(".do_set_open_pref").addClass("open-pdf-in-acrobat"),l=!0)}}));